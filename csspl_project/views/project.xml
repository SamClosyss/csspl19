<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!--    Master Menu of Atm ID in Configration of HR Expense-->
    <record id="view_atm_id_tree" model="ir.ui.view">
        <field name="name">atm.id.tree</field>
        <field name="model">atm.id</field>
        <field name="arch" type="xml">
            <list editable="top">
                <field name="name"/>
            </list>
        </field>
    </record>

    <record id="action_atm_id" model="ir.actions.act_window">
        <field name="name">ATM ID</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">atm.id</field>
        <field name="view_mode">list</field>
    </record>

    <menuitem
            id="menu_atm_id"
            parent="hr_expense.menu_hr_expense_configuration"
            name="ATM ID"
            action="action_atm_id"
            sequence="10"/>

    <!--    Atm ID field added in HR Expenses -->
    <record id="inherited_hr_expense_form_view" model="ir.ui.view">
        <field name="name">inherited_hr_expense_form_view</field>
        <field name="model">hr.expense</field>
        <field name="inherit_id" ref="hr_expense.hr_expense_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='analytic_distribution']" position="after">
                <field name="atm_ids" string="ATM ID" widget="many2many_tags"/>
            </xpath>
        </field>
    </record>

    <!--    Analytic Field added in Approval Fields -->
    <record id="inherited_approval_category_form_view" model="ir.ui.view">
        <field name="name">inherited_approval_category_form_view</field>
        <field name="model">approval.category</field>
        <field name="inherit_id" ref="approvals.approval_category_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='option_settings']" position="inside">
                <field name="analytic" string="Analytic" widget="radio" options="{'horizontal': true}"/>
                <field name="bank_account" widget="radio" options="{'horizontal': true}"/>
            </xpath>
        </field>
    </record>

    <!--    Added Analytical Account Field in Approval Request & Create payment Button in Header -->
    <record id="inherited_approval_request_form_view" model="ir.ui.view">
        <field name="name">inherited_approval_request_form_view</field>
        <field name="model">approval.request</field>
        <field name="inherit_id" ref="approvals.approval_request_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='amount']" position="after">
                <field name="analytic" invisible="1"/>
                <field name="analytical_account_id"
                       invisible="analytic == 'no'"
                       required="analytic == 'required'"
                       readonly="request_status != 'new'"
                       options="{'no_create': True, 'no_open': True}"/>

            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="bank_account"
                       invisible="bank_account_selection == 'no'"
                        required="bank_account_selection == 'required'"
                       options="{'no_create': True}"/>
                <field name="bank_account_selection" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='category_id']" position="replace">
                <field name="category_id" readonly="request_status != 'new'" force_save="1"
                       options="{'no_create': True, 'no_open': True}"/>
            </xpath>
            <xpath expr="//header" position="inside">
                <field name="is_payment_created" invisible="1"/>
                <button id="create_payment" name="create_payment" string="Create payment"
                        class="btn-success" type="object"
                        invisible="request_status != 'approved' or is_payment_created == True"/>
                <button id="view_payment" name="view_payment" string="View payment"
                        class="btn-success" type="object"
                       invisible="request_status != 'approved' or is_payment_created == False"/>
            </xpath>
        </field>
    </record>

    <!--  Inherited Project Form View  -->
    <record id="inherited_project_form_view" model="ir.ui.view">
        <field name="name">inherited_project_form_view</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <!--  Header  -->
            <xpath expr="//header" position="inside">
                <button name="action_create_payment_approval" string="Payment Approval" class="btn btn-sm btn-primary"
                        type="object"/>
            </xpath>

            <xpath expr="//field[@name='user_id']" position="after">
                <field name="billing_type"/>
            </xpath>

<!--            <xpath expr="//button[@name='%(project.project_share_wizard_action)d'][1]" position="replace"/>-->

            <!--   Smart Button to View invoices created from Project -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" name="action_view_tasks" type="object" icon="fa-tasks"
                        invisible="task_count == 0">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="task_count" nolabel="1"/>
                        </span>
                        <span class="o_stat_text text-sm">
                            Tasks
                        </span>
                    </div>
                </button>
                <!--   Smart Button to View All Payment Approvals  -->
                <button class="oe_stat_button" name="action_view_payment_approval" type="object" icon="fa-rupee"
                        invisible="payment_approval_count == 0">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="payment_approval_count" nolabel="1"/>
                        </span>
                        <span class="o_stat_text text-sm">
                            Approvals
                        </span>
                    </div>
                </button>
            </xpath>

            <!--   Smart Button to View account payment created from Project -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_payments" type="object" class="oe_stat_button" string="payments"
                        icon="fa-money" invisible="payment_count == 0">
                    <div class="o_stat_info">
                        <field name="payment_count" class="o_stat_value"/>
                        <span class="o_stat_text">Payments</span>
                    </div>
                </button>
            </xpath>

            <!--   Smart Button to View account move created from Project -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_bills" type="object" class="oe_stat_button" string="payments"
                        icon="fa-usd" invisible="bill_count == 0">
                    <div class="o_stat_info">
                        <field name="bill_count" class="o_stat_value"/>
                        <span class="o_stat_text">Bills</span>
                    </div>
                </button>
            </xpath>

            <!--   Smart Button to View invoices created from Project -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="project_invoice_count" invisible="1"/>
                <button class="oe_stat_button" name="action_view_invoices" type="object" icon="fa-money"
                        invisible="project_invoice_count &lt; 1">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="project_invoice_count" nolabel="1"/>
                        </span>
                        <span class="o_stat_text text-sm">
                            Invoices
                        </span>
                    </div>
                </button>
            </xpath>

            <!-- Smart Button to view Purchase Order lines           -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" name="action_view_purchase_lines" type="object" icon="fa-credit-card"
                        invisible="purchase_line_count == 0">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="purchase_line_count" nolabel="1"/>
                        </span>
                        <span class="o_stat_text text-sm">
                            Purchase Lines
                        </span>
                    </div>
                </button>
            </xpath>

            <!-- Smart Button to view Delivery Orders   -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" name="action_view_deliveries" type="object" icon="fa-truck"
                        invisible="delivery_count == 0">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="delivery_count" nolabel="1"/>
                        </span>
                        <span class="text-sm">
                            Deliveries
                        </span>
                    </div>
                </button>
            </xpath>

            <xpath expr="//form//group//field[@name='partner_id']" position="after">
                <field name="price_list_id" options="{'no_open': True, 'no_create': True}"/>
                <field name="tax_ids" widget="many2many_tags" options="{'no_create': True, 'no_open': True}"/>
            </xpath>


            <!--  Project Form Notebook -> Page  -->
            <xpath expr="//page[1]" position="after">
                <page string="Tasks">
                    <field name="task_ids" widget="one2many_search">
                        <list>
                            <field name="service_code"/>
                            <field name="product_id" context="{'default_detailed_type': 'product'}"
                                   options="{'no_quick_create': True}"/>
                            <field name="uom_id" string="UOM"/>
                            <field name="work_order_type" invisible="1"/>
                            <field name="work_order_type_id"/>
                            <field name="milestone_id"/>
                            <field name="date_deadline"/>
                            <field name="tag_ids" widget="many2many_tags" optional="hide"/>
                            <field name="quantity"/>
                            <field name="price_unit"/>
<!--                            <field name="untaxed_amt" force_save="1"/>-->
                            <field name="invoice_lines" widget="many2many_tags" invisible="1"/>
                            <field name="invoice_amount"/>
                            <field name="price_list_id" invisible="1"/>
                        </list>
                    </field>
                </page>
                <page string="Materials">
                    <field name="boq_line_ids" widget="one2many_search">
                        <list create="0" delete="0" editable="bottom">
                            <field name="task_id" readonly="1" force_save="1" optional="hide"/>
                            <field name="partner_id" invisible="1"/>
                            <field name="product_id"
                                   options="{'no_create': True, 'no_edit_open': True, 'no_open': True}"
                                   force_save="1"/>
                            <field name="uom_id" string="UOM"/>
                            <field name="required_qty" readonly="1" force_save="1"/>
                            <field name="rfq_qty"/>
                            <field name="kit_qty" invisible="1"/>
                            <field name="incoming_qty" readonly="True" force_save="1"/>
                            <field name="purchased_qty" readonly="True" force_save="1"/>
                            <field name="in_progress_delivery" string="Out Progress"/>
                            <field name="delivered_qty" force_save="1"/>
                            <field name="rfq_value" force_save="1"/>
                            <field name="purchase_value" force_save="1"/>
                            <field name="bill_amount"/>
                            <field name="company_id" invisible="1"/>
                        </list>
                    </field>
                </page>
            </xpath>

            <xpath expr="//notebook" position="after">
                <group name="note_group" col="6" class="mt-2 mt-md-0">
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                        <field name="work_order_amt" colspan="2"/>
                        <field name="project_value" colspan="2"/>
                        <field name="tax_amount" colspan="2"/>
                        <field name="price_total" colspan="2"/>
                        <field name="rfq_value" force_save="1"/>
                        <field name="purchase_value" force_save="1"/>
                        <field name="bill_amount" force_save="1"/>
                        <field name="invoice_amount" force_save="1"/>
                        <field name="old_invoice_amt" force_save="1"/>
                        <field name="payment_amount"/>
                        <field name="old_payment_amt"/>
                        <field name="margin"/>
                    </group>
                    <div class="clearfix"/>
                </group>
            </xpath>
        </field>
    </record>

    <!--  Inherited Task Form View  -->
    <record id="inherited_project_task_form_view" model="ir.ui.view">
        <field name="name">inherited_project_task_form_view</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">

            <xpath expr="//notebook" position="before">
                <hr/>
                <group>
                    <group>
                        <field name="work_order_type" readonly="product_id != False" required="0"
                               force_save="1" invisible="1"/>
                        <field name="work_order_type_id"/>
                        <field name="product_id"
                               domain="[('order_type_product_id', '=', work_order_type_id)]"
                               options="{'no_create': True, 'no_open': True}"/>
                        <!--                        attrs="{'readonly': [('work_order_type', '=', False)]}"-->
                        <field name="service_code"/>
                        <field name="uom_id" options="{'no_create': True, 'no_open': True}"/>
                    </group>
                    <group>
                        <field name="quantity"/>
                        <field name="price_unit" readonly="0"/>
                        <field name="tax_ids" widget="many2many_tags" options="{'no_create': True, 'no_open': True}"/>
<!--                        <field name="untaxed_amt" force_save="1"/>-->
                        <field name="tax_amount" readonly="1" force_save="1"/>
                        <field name="price_total" readonly="1" force_save="1"/>
                    </group>
                </group>
                <hr/>
            </xpath>

            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_open': True}</attribute>
                <attribute name="readonly">1</attribute>
                <attribute name="force_save">True</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_open': True}</attribute>
                <attribute name="readonly">1</attribute>
                <attribute name="force_save">True</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="price_list_id" options="{'no_open': True, 'no_create': True}"/>
            </xpath>

            <xpath expr="//field[@name='milestone_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_open': True}</attribute>
            </xpath>

            <xpath expr="//field[@name='user_ids']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_open': True}</attribute>
            </xpath>

            <xpath expr="//page[1]" position="before">
                <page string="Materials">
                    <field name="boq_line_ids" widget="one2many_search">
                        <list editable="bottom">
                            <field name="add_product" invisible="1"/>
                            <field name="remove_product" invisible="1"/>
                            <button name="action_add" icon="fa-upload" class="btn btn-success"
                                    invisible="add_product == False" type="object"/>
                            <button name="action_remove" icon="fa-times" class="btn btn-danger"
                                    invisible="remove_product == False" type="object"/>
                            <field name="line_readonly" invisible="1"/>
                            <field name="partner_id" invisible="1"/>
                            <field name="product_id" readonly="line_readonly == True"
                                   force_save="1" required="1"/>
                            <field name="uom_id" string="UOM"/>
                            <field name="required_qty"/>
                            <field name="kit_qty" invisible="1"/>
                            <field name="rfq_qty"/>
                            <field name="incoming_qty" readonly="True" force_save="1"/>
                            <field name="purchased_qty" readonly="True" force_save="1"/>
                            <field name="in_progress_delivery" string="Out Progress"/>
                            <field name="delivered_qty" force_save="1"/>
                            <field name="rfq_value" force_save="1"/>
                            <field name="purchase_value" force_save="1"/>
                            <field name="bill_amount"/>
                            <field name="company_id" invisible="1"/>
                        </list>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Inherited Project Kanban View  -->
    <record id="project_kanban_view_inherit" model="ir.ui.view">
        <field name="name">project_kanban_view_inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <!-- Xpath to remove action attribute from kanban as it was opening Task Kanban View  -->
            <xpath expr="//kanban" position="attributes">
                <attribute name="action"/>
            </xpath>

            <xpath expr="//main" position="inside">
                <span class="text-muted o_row">Project Value:
                    <field name="project_value"/>
                </span>
                <br/>
                <span class="text-muted o_row">RFQ Value:
                    <field name="rfq_value"/>
                </span>
                <br/>
                <span class="text-muted o_row">Purchase Value:
                    <field name="purchase_value"/>
                </span>
                <br/>
                <span class="text-muted o_row">Bill Value:
                    <field name="bill_amount"/>
                </span>
                <br/>
                <span class="text-muted o_row">Invoice Value:
                    <field name="invoice_amount"/>
                </span>
                <br/>
                <span class="text-muted o_row">Payment Amount:
                    <field name="payment_amount"/>
                </span>
                <br/>
                <span class="text-muted o_row">Margin:
                    <field name="margin"/>
                </span>
            </xpath>

        </field>
    </record>

    <!-- Inherited Product Form View   -->
    <record id="product_form_view_inherit" model="ir.ui.view">
        <field name="name">product_form_view_inherit</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">

            <xpath expr="//page[@name='general_information']//field[@name='type']" position="before">
                <!--                <field name="order_type_product" attrs="{'invisible': [('detailed_type', '!=', 'service')]}"/>-->
                <field name="order_type_product_id" invisible="type != 'service'"/>
            </xpath>

            <xpath expr="//page[last()]" position="after">
                <page string="Kit"
                      invisible="order_type_product_id == False or type != 'service'">
                    <field name="kit_ids">
                        <list editable="bottom">
                            <field name="product_templ_id" invisible="1"/>
                            <field name="product_id" context="{'default_type': 'consu'}"/>
                            <field name="uom_id" string="UOM"/>
                            <field name="quantity"/>
                        </list>
                    </field>
                </page>
            </xpath>

        </field>
    </record>

    <!-- Tree View of UOM.Conversion   -->
    <record model="ir.ui.view" id="uom_conversion_tree_view">
        <field name="name">uom_conversion_tree_view</field>
        <field name="model">uom.conversion</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="from_uom" options="{'no_create': True, 'no_open': True, 'no_edit': True}"/>
                <field name="to_uom" options="{'no_create': True, 'no_open': True, 'no_edit': True}"/>
                <field name="formula"/>
            </list>
        </field>
    </record>

    <record id="uom_conversion_action" model="ir.actions.act_window">
        <field name="name">UOM Conversion</field>
        <field name="res_model">uom.conversion</field>
        <field name="view_mode">list</field>
    </record>

    <menuitem id="uom_conversion_menu" name="UOM Conversion" action="uom_conversion_action"
              parent="project.menu_main_pm"/>

    <!-- Inherited Project Task Tree View   -->
    <record id="task_tree_view_inherit" model="ir.ui.view">
        <field name="name">task_tree_view_inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="work_order_type_id"/>
            </xpath>
            <xpath expr="//field[@name='stage_id']" position="before">
                <field name="quantity"/>
                <field name="price_unit"/>
<!--                <field name="untaxed_amt"/>-->
                <field name="rfq_value"/>
                <field name="purchase_value"/>
                <field name="bill_amount"/>
                <field name="invoice_amount"/>
            </xpath>
        </field>
    </record>


    <!-- Inherited Project Tree View   -->
    <record id="project_tree_view_inherit" model="ir.ui.view">
        <field name="name">project_tree_view_inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date']" position="after">
                <field name="project_value"/>
                <field name="rfq_value"/>
                <field name="bill_amount"/>
                <field name="invoice_amount"/>
                <field name="payment_amount"/>
                <field name="margin"/>
            </xpath>
        </field>
    </record>

    <!-- Inherited Project Task Action to stop creating task from here   -->
    <!--    <record id="project.action_view_all_task" model="ir.actions.act_window">-->
    <!--        <field name="context">{'create': 0}</field>-->
    <!--    </record>-->

    <!--  Inherited Price List  -->
    <record id="inherited_price_list_form_view" model="ir.ui.view">
        <field name="name">inherited_price_list_form_view</field>
        <field name="model">product.pricelist</field>
        <field name="inherit_id" ref="product.product_pricelist_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='item_ids']" position="attributes">
                <attribute name="widget">one2many_search</attribute>
            </xpath>
        </field>
    </record>

    <record id="work_order_type_tree_view" model="ir.ui.view">
        <field name="name">work.order.type.tree</field>
        <field name="model">work.order.type</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="name"/>
            </list>
        </field>
    </record>

    <record id="action_work_order_type" model="ir.actions.act_window">
        <field name="name">Work Order Type</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">work.order.type</field>
        <field name="view_mode">list</field>
    </record>

    <menuitem id="work_order_type_menu" name="Work Order Type" parent="project.menu_project_config"
              action="action_work_order_type"/>

</odoo>